<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="./assests/css/custom.css">
  <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
/>
  <style>
    .webchat--css-eotrw-1tdc372.webchat__basic-transcript {
      background-color: bisque;
    }
   .header-image{
     width: 31%;
    height: 50%;
    padding: 10px 5px 5px 5px;
   }
    .main {
      margin: 18px;
      border-radius: 4px;
    }

    div[role="form"] {
      /* background-color: #1A3265; */
    }

    div[role="log"] {
      background: gainsboro;
    }

    div[role="status"] {
      background: darkgray;
    }

    #webchat {
      position: fixed;
      height: 50%;
      z-index: 9999;
      width: 400px;
      bottom: 51px;
      overflow: hidden;
    }
    .webchat--css-gmgkj-1egyv3b{
      background-color: white;
      height: 86%;
      width: 100%;
      z-index: 0;
    }
    .webchat--css-pbugq-1egyv3b {
    background-color: white;
    height: 86%;
    width: 100%;
    z-index: 0;
}
    /* Button used to open the chat form - fixed at the bottom of the page */
    .open-button {
/* background-color: #1A3265; */
color: white;
 padding: 16px 20px;
 border: none;
 cursor: pointer;
 opacity: 1;
 position: fixed;
 bottom: 10px;
 right: 28px;
 height: 60px;
 width: 60px;
 border-radius: 5px;
    }
  </style>
  <title>Atara test</title>
</head>

<body >
  <!-- <button class="open-button" onclick="openChat()">Chat Bot</button> -->
  <!-- <img class="open-button" id="chatButton" onclick="openChat()" style="display: none;" src="./assests/img/bot-image.png" width="30%"> -->
  <div id="chat-circle" class="btn-raised animate__animated animate__fadeInLeft" onclick="openChat()"  style="display: none;">
    <svg class="icon-speech" viewBox="0 0 48 48">
          <use xlink:href="#icon-speech" />
        </svg>	</div>
  <div class="container main" id="chatBox"
    style="order: 3; position: relative; display: none; float: right; width: 400px; min-width: 400px; height: 100%;">

    <div id="webchat" style="border-radius: 15px 15px 15px 15px;">
      <div role="main"></div>
    </div>
    <script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>
  </div>
    <!-- Symbols -->
    <svg>
      <!-- Close icon -->
      <symbol id="icon-close" viewBox="0 0 32 32">
        <title>Close</title>
        <path d="M2.624 8.297l2.963-2.963 23.704 23.704-2.963 2.963-23.704-23.704z" />
        <path d="M2.624 29.037l23.704-23.704 2.963 2.963-23.704 23.704-2.963-2.963z" />
      </symbol>
    
      <!-- Speech icon -->
      <symbol id="icon-speech" viewBox="0 0 32 32">
        <title>Speech</title>
        <path style="fill: #ffffff; fill-rule: evenodd;" d="M21.795 5.333h-11.413c-0.038 0-0.077 0-0.114 0l-0.134 0.011v2.796c0.143-0.006 0.273-0.009 0.385-0.009h11.277c0.070 0 7.074 0.213 7.074 7.695 0 5.179-2.956 7.695-9.036 7.695h-3.792c-0.691 0-1.12 0.526-1.38 1.159l-1.387 3.093-1.625 3.77 0.245 0.453h2.56l2.538-5.678h2.837c7.633 0 11.84-3.727 11.84-10.494 0.001-8.564-7.313-10.492-9.875-10.492z" />
        <path style="fill: #ffffff; fill-rule: evenodd;" d="M10.912 24.259c-0.242-0.442-0.703-0.737-1.234-0.737-0 0-0 0-0 0h-0.56c-0.599-0.011-1.171-0.108-1.71-0.28l0.042 0.012c-1.82-0.559-4.427-2.26-4.427-7.424 0-6.683 5.024-7.597 7.109-7.686v-2.8c-2.042 0.095-9.91 1.067-9.91 10.483 0 4.832 1.961 7.367 3.606 8.64 1.38 1.067 3.109 1.744 4.991 1.843l0.033 0.019 2.805 5.211 1.41-3.273z" />
      </symbol>
    
      <!-- Send icon -->
      <symbol id="icon-send" viewBox="0 0 23.97 21.9">
        <title>Send</title>
        <path d="M0.31,9.43a0.5,0.5,0,0,0,0,.93l8.3,3.23L23.15,0Z"/>
        <path d="M9,14.6H9V21.4a0.5,0.5,0,0,0,.93.25L13.22,16l6,3.32A0.5,0.5,0,0,0,20,19l4-18.4Z"/>
      </symbol>
      
      <!-- Avatar icon -->
      <symbol id="avatar" width="44.25" height="44" viewBox="0 0 44.25 44">
        <title>Avatar</title>
        <path style="fill: #bf2024; fill-rule: evenodd;" d="M1035.88,1696.25a22,22,0,1,1-22.13,22A22.065,22.065,0,0,1,1035.88,1696.25Z" transform="translate(-1013.75 -1696.25)"/>
        <path style="fill: #fff; fill-rule: evenodd;" d="M1030.18,1725.16h2.35a0.335,0.335,0,0,0,.34-0.33v-5.23h5.94v5.23a0.342,0.342,0,0,0,.34.33h2.36a0.342,0.342,0,0,0,.34-0.33v-12.36a0.34,0.34,0,0,0-.34-0.32h-2.36a0.34,0.34,0,0,0-.34.32v4.51h-5.94v-4.51a0.333,0.333,0,0,0-.34-0.32h-2.35a0.333,0.333,0,0,0-.34.32v12.36a0.335,0.335,0,0,0,.34.33" transform="translate(-1013.75 -1696.25)"/>
      </symbol>
      
    </svg>
  <script>
    function openChat() {
      document.getElementById("chatBox").style.display = "block";
      document.getElementById("chat-circle").style.display = "none";
    }
    function closeChat() {
      document.getElementById("chatBox").style.display = "none";
    }
    (async function () {
      document.querySelectorAll('[role="main"]')[0].setAttribute("id", "webchat");
      var BOT_ID = "uPiVmUQ6Dgc.LDl0d5dhJ2YNSVJCvJL5HpP1xPmsW7z9kEBn1PtTf1A";
      var theURL = "https://directline.botframework.com/v3/directline/conversations";
      const res = await fetch('https://directline.botframework.com/v3/directline/conversations', {
        method: 'POST',
        headers: {
          Authorization: `Bearer ${BOT_ID}`,
        }
      });
      const { token } = await res.json();
      //------------------------------------------------------


      const store = window.WebChat.createStore({}, ({ dispatch }) => next => action => {
        if (action.type === 'DIRECT_LINE/CONNECT_FULFILLED') {
          dispatch({
            type: 'WEB_CHAT/SEND_EVENT',
            payload: {
              name: 'webchat/join',
              value: { language: window.navigator.language }
            }
          });
        }

        return next(action);
      });
      const styleSet = window.WebChat.createStyleSet({
        bubbleBackground: 'rgba(0, 0, 255, .1)',
        bubbleFromUserBackground: 'rgba(0, 255, 0, .1)',
      });
      const styleOptions = {
        hideUploadButton: true,
        sendBoxButtonColor: 'rgb(163,35,32)'
      };

      // After generated, you can modify the CSS rules
      window.WebChat.renderWebChat(
        {
          directLine: window.WebChat.createDirectLine({ token,  webSocket: true, }),
          store,
          styleSet,
          styleOptions
        },
        document.getElementById('webchat')
      );

      document.querySelector('#webchat > *').focus();
      const newDiv = document.createElement('div');
      newDiv.setAttribute('class','chatbot__header');
      newDiv.onclick = () => {
        closeChat()
        document.getElementById("chat-circle").style.display = 'block' 
      };
      newDiv.setAttribute('id','chatHeader');
      const htmlText = '<div><img class="header-image" src="./assests/img/ataraImage.jpg"> <span class="u-text-highlight"></span></div><svg class="chatbot__close-button icon-speech" viewBox="0 0 32 32"><use xlink:href="#icon-speech" /></svg><svg class="chatbot__close-button icon-close" viewBox="0 0 32 32"><use xlink:href="#icon-close"  data-toggle="modal" data-target="#basicModal" /></svg>';
      newDiv.innerHTML = htmlText;
      document.getElementById('webchat').prepend(newDiv);
      // get the next sibling and adjust the height 
      document.getElementById('chatHeader').nextElementSibling.style.height = '86%';
    

    })().catch(err => console.error(err));
    setTimeout(() => {
      document.getElementById("chat-circle").style.display = "block";
    },20000)
  </script>
</body>

</html>
